# windows修改进程内存
## 大一向
什么是程序？什么是进程？
```bash
ps -aux // 任务管理器
```
程序是如何运行的？
程序运行时的内存布局
## 复习 - 进程的地址空间
虚拟内存
- 对进程透明，让程序如同拥有整个物理内存
- 内存隔离，保护进程不被其他进程入侵
- Every address generated by user program is a **virtual address**
虚拟地址空间对进程的限制
![image.png](https://raw.githubusercontent.com/shenzaoyi/phot0_bed/main/img_windows20241017192503.png)
进程的物理地址由操作系统完全安排，进程和进程之间无法直接访问对方的地址空间(是不是矛盾？推动虚拟内存的就是为了内存隔离，现在为什么要打破这个隔离：性能检测工具，调试器 )，进程之间通信只能通过操作系统提供的渠道。
## 打破常规 - 入侵进程的地址空间
### 游戏修改器
玩单机游戏的时候，一个不符合你口味的boss，一直打不过去或者想杀它一百遍，想要渣渣灰的高爆率或者成龙大哥的一刀999，你会......
找到名曰游戏修改器的神器。
![image.png](https://raw.githubusercontent.com/shenzaoyi/phot0_bed/main/img_windows20241017193212.png)
![image.png](https://raw.githubusercontent.com/shenzaoyi/phot0_bed/main/img_windows20241017193317.png)
![image.png](https://raw.githubusercontent.com/shenzaoyi/phot0_bed/main/img_windows20241017193413.png)
那么，游戏修改器是如何做到修改一个正在运行的游戏的内存数据？
/演示
### 目标
和演示一样，实现一个简单的内存扫描工具，修改游戏的某一项数值。
### 入侵的方法
寻求操作系统的帮助
一个正在运行的程序，地址空间对应的物理内存的修改？
![image.png](https://raw.githubusercontent.com/shenzaoyi/phot0_bed/main/img_windows20241017194808.png)
直接修改0xf70000显然不可以，每个进程的地址都是虚拟的，修改的明显是自己的虚拟地址的内容。
寻求操作系统的帮助：
1. [/porc_pid_mem](https://man7.org/linux/man-pages/man5/proc_pid_mem.5.html)
2. [VituralQueryEX](https://learn.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-virtualqueryex)
无论是windows还是linux，都为我们提供了多种(此处列举只是今天我需要讲的，除此之外还有更多方法)获取其他进程运行时内存访问方法。(反思，为什么操作系统要提供这么危险的动作？)


## 实现的步骤
### 总览
![image.png](https://raw.githubusercontent.com/shenzaoyi/phot0_bed/main/img_windows20241017210605.png)
### 获取进程内存信息
- VirtualQueryEx
- ReadProcessMemory
- WriteProcessMemory
/code
/demo
![image.png](https://raw.githubusercontent.com/shenzaoyi/phot0_bed/main/img_windows20241019135950.png)

## 反思
### 从修改器实现，发现操作系统也会留后门，但是这么危险的操作，为什么还会留下
1. **系统维护和故障排查**
系统管理员和支持技术人员可能需要访问进程的内存来诊断问题、监控系统的健康状况或进行性能优化。例如，如果一个应用程序出现内存泄漏，通过这些工具可以帮助找到问题的根源。
 2. **开发和调试**
开发者在创建和调试软件时，需要能够查看和修改应用程序的内存状态。这对于理解程序行为、检查数据结构的状态以及实现复杂的功能是非常有用的。
 3. **兼容性和扩展性**
一些旧软件或特定的应用场景可能依赖于直接操作内存的能力来实现特定功能或维持兼容性。操作系统提供这些功能以支持广泛的应用程序和服务。
4. **安全研究和测试**

安全研究人员使用这些功能来测试系统的安全性，发现和修复漏洞。这是提高软件和系统安全性的重要手段。

## 完美结束
帖指导： 
1. 未来职业： 考研 + 高起点
2. 交流
	1. 社区交流
	2. 实验室交流 - 潘非凡； 
	3. 大牛交流 -  鸿蒙之父，陈海波
3. OS实验案例 - 给帖军的操作系统做大作业
4. 技术 & 工程
5. PS: **江的阴谋论，帖军从来没有直接问绩点 &考研学校，以及大牛，这哥们肯定有资源，再去找他要。**